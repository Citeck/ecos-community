<?xml version="1.0" encoding="UTF-8"?>
<model name="sam:sam" xmlns="http://www.alfresco.org/model/dictionary/1.0">
    <description>Digital signature aspect model</description>
    <author>Citeck</author>
    <version>1.0</version>
    <imports>
        <import uri="http://www.alfresco.org/model/dictionary/1.0" prefix="d"/>
        <import uri="http://www.alfresco.org/model/content/1.0" prefix="cm"/>
        <import uri="http://www.alfresco.org/model/datalist/1.0" prefix="dl"/>
        <import uri="http://www.citeck.ru/model/content/idocs/1.0" prefix="idocs"/>
    </imports>

    <namespaces>
        <namespace uri="http://www.citeck.ru/model/sam/1.0" prefix="sam"/>
    </namespaces>

    <constraints>
        <constraint name="sam:constraint:packageStatuses" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>SENT</value>
                    <value>SIGNED</value>
                    <value>REJECTED</value>
                    <value>DELIVERED</value>
                    <value>DELIVERY_FAILED</value>
                    <value>RECEIVED</value>
                </list>
            </parameter>
        </constraint>
        <constraint name="sam:constraint:packageAttachmentStatuses" type="LIST">
            <parameter name="allowedValues">
                <list>
                    <value>SENT</value>
                    <value>SIGNED</value>
                    <value>REJECTED</value>
                    <value>DELIVERED</value>
                    <value>DELIVERY_FAILED</value>
                    <value>RECEIVED</value>
                    <value>REVOCATION_ACCEPTED</value>
                    <value>REVOCATION_REJECTED</value>
                    <value>REVOCATION_IS_REQUESTED_BY_ME</value>
                    <value>REQUESTS_MY_REVOCATION</value>
                    <value>CORRECTION_REQUESTED</value>
                    <value>REVISIONED</value>
                    <value>CORRECTED</value>
                    <value>REVISION_CORRECTED</value>
                    <value>BUYER_TITLE_SIGNED</value>
                    <value>SIGN_SENT</value>
                    <value>REJECTION_SENT</value>
                </list>
            </parameter>
        </constraint>

        <constraint name="sam:percentage" type="MINMAX">
            <parameter name="minValue">
                <value>0</value>
            </parameter>
            <parameter name="maxValue">
                <value>100</value>
            </parameter>
        </constraint>

    </constraints>

    <types>
        <type name="sam:package">
            <title>Package Of Documents</title>
            <parent>dl:dataListItem</parent>
            <properties>
                <property name="sam:packageId">
                    <title>Contour packet Id</title>
                    <type>d:text</type>
                </property>
                <property name="sam:packageStatus">
                    <title>Status</title>
                    <type>d:text</type>
                    <constraints>
                        <constraint ref="sam:constraint:packageStatuses"/>
                    </constraints>
                </property>
                <property name="sam:packageErrorCode">
                    <title>Error Code</title>
                    <type>d:text</type>
                </property>
                <property name="sam:percentComplete">
                    <type>d:int</type>
                    <default>0</default>
                    <constraints>
                        <constraint ref="sam:percentage"/>
                    </constraints>
                </property>
            </properties>
            <associations>
                <association name="sam:packageDocumentLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>idocs:doc</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>
            <mandatory-aspects>
                <aspect>sam:hasPackageAttachments</aspect>
                <aspect>sam:hasMessageId</aspect>
            </mandatory-aspects>
        </type>

        <type name="sam:inboundPackage">
            <title>Inbound Package</title>
            <parent>sam:package</parent>
        </type>

        <type name="sam:outboundPackage">
            <title>Outbound Package</title>
            <parent>sam:package</parent>
        </type>

        <type name="sam:signableXml">
            <title>SignableXml</title>
            <parent>dl:dataListItem</parent>
            <mandatory-aspects>
                <aspect>sam:signable</aspect>
            </mandatory-aspects>
        </type>

        <type name="sam:rejectionComment">
            <title>Rejection Comment</title>
            <parent>sam:signableXml</parent>
        </type>

        <type name="sam:revocationXml">
            <title>RevocationXml</title>
            <parent>sam:signableXml</parent>
        </type>

        <type name="sam:sign">
            <title>ESign</title>
            <parent>cm:content</parent>
            <mandatory-aspects>
                <aspect>sam:hasSigner</aspect>
                <aspect>sam:hasSignDate</aspect>
                <aspect>sam:hasCertificateData</aspect>
                <aspect>sam:hasSignValid</aspect>
            </mandatory-aspects>
        </type>
    </types>

    <aspects>

        <aspect name="sam:signable">
            <title>Digital signature</title>
            <properties>
                <property name="sam:signValue">
                    <title>Digital signature value</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:signer">
                    <title>Signer</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
            </properties>
            <associations>
                <child-association name="sam:signLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>sam:sign</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
            <mandatory-aspects>
                <aspect>sam:hasSignDate</aspect>
                <aspect>sam:hasSignValid</aspect>
            </mandatory-aspects>
        </aspect>

        <aspect name="sam:hasSigner">
            <title>Has Signer</title>
            <properties>
                <property name="sam:signerFullName">
                    <title>Signer Full Name</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:signerEmail">
                    <title>Signer email</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:signerPosition">
                    <title>Signer Position</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:signerCompany">
                    <title>Signer Company</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasSignDate">
            <title>Has Sign Date</title>
            <properties>
                <property name="sam:signDate">
                    <type>d:datetime</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasSignValid">
            <title>Has Sign Valid</title>
            <properties>
                <property name="sam:isSignValid">
                    <title>Is Sign Valid</title>
                    <type>d:boolean</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasContractorSignValid">
            <title>Has Contractor Sign Valid</title>
            <properties>
                <property name="sam:isContractorSignValid">
                    <title>Is Contractor Sign Valid</title>
                    <type>d:boolean</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasCertificateData">
            <title>Has Certificate Data</title>
            <properties>
                <property name="sam:certificateSerialNumber">
                    <title>Certificate Serial Number</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:certificateIssuerName">
                    <title>Certificate Issuer Name</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:certificateStartDate">
                    <title>Certificate Start Date</title>
                    <type>d:date</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:certificateEndDate">
                    <title>Certificate End Date</title>
                    <type>d:date</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:certificateIssuerOrganization">
                    <title>Certificate Name</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:isCertificateValid">
                    <title>Is Certificate Valid</title>
                    <type>d:boolean</type>
                    <mandatory>false</mandatory>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:isRejectable">
            <title>Document could be rejected</title>
            <associations>
                <child-association name="sam:rejectionCommentLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>sam:rejectionComment</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
        </aspect>

        <aspect name="sam:isRevocationRequested">
            <title>Revocation of document is requested by us</title>
            <associations>
                <child-association name="sam:revocationXmlLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>sam:revocationXml</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
        </aspect>

        <aspect name="sam:isInvoiceCorrectionRequested">
            <title>Invoice correction xml is requested by us</title>
            <associations>
                <child-association name="sam:invoiceCorrectionRequestXmlLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>sam:signableXml</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
        </aspect>

        <aspect name="sam:acceptanceLinkedDocs">
            <title>Invoice correction xml is requested by us</title>
            <associations>
                <child-association name="sam:buyerTitleXmlLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>sam:signableXml</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
        </aspect>

        <aspect name="sam:hasContractorSign">
            <title>Contractor digital signature</title>
            <properties>
                <property name="sam:comment">
                    <title>Comment</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:contractorSignValue">
                    <title>Digital signature value</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:contractorSignDate">
                    <type>d:datetime</type>
                </property>
            </properties>
            <associations>
                <child-association name="sam:contractorSignLink">
                    <source>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </source>
                    <target>
                        <class>sam:sign</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </child-association>
            </associations>
            <mandatory-aspects>
                <aspect>sam:hasContractorSignValid</aspect>
            </mandatory-aspects>
        </aspect>

        <aspect name="sam:hasPackageAttachments">
            <associations>
                <association name="sam:packageAttachments">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>cm:content</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>
        </aspect>

        <aspect name="sam:hasSignCopy">
            <associations>
                <association name="sam:signCopy">
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>sam:sign</class>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </target>
                </association>
            </associations>
        </aspect>


        <aspect name="sam:hasEntityId">
            <properties>
                <property name="sam:entityId">
                    <title>Entity Id in Contour</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
                <property name="sam:packageAttachmentStatus">
                    <title>Status</title>
                    <type>d:text</type>
                    <constraints>
                        <constraint ref="sam:constraint:packageAttachmentStatuses"/>
                    </constraints>
                </property>
            </properties>
            <mandatory-aspects>
                <aspect>sam:hasMessageId</aspect>
            </mandatory-aspects>
        </aspect>

        <aspect name="sam:hasAttachmentType">
            <properties>
                <property name="sam:attachmentType">
                    <title>Type</title>
                    <type>d:text</type>
                </property>
            </properties>
        </aspect>
        
        <aspect name="sam:hasAttachmentVersion">
            <properties>
                <property name="sam:attachmentVersion">
                    <title>Version</title>
                    <type>d:text</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasPackageStatusCopy">
            <properties>
                <property name="sam:packageStatusCopy">
                    <type>d:text</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasShouldBeSigned">
            <properties>
                <property name="sam:shouldBeSigned">
                    <type>d:boolean</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasMessageId">
            <properties>
                <property name="sam:messageId">
                    <title>Kontur id of message in wich attachment has been sent</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasDiadocBoxId">
            <properties>
                <property name="sam:counterPartyBoxId">
                    <title>Kontur boxid of counteragent</title>
                    <type>d:text</type>
                    <mandatory>false</mandatory>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:hasContentFromInboundPackage">
            <associations>
                <association name="sam:contentFromInboundPackage">
                    <title>The content of the node received from the inbound package</title>
                    <source>
                        <mandatory>false</mandatory>
                        <many>true</many>
                    </source>
                    <target>
                        <class>cm:content</class>
                        <mandatory>false</mandatory>
                        <many>false</many>
                    </target>
                </association>
            </associations>
        </aspect>

        <aspect name="sam:hasClientBoxId">
            <properties>
                <property name="sam:clientBoxId">
                    <title>Client box identifier</title>
                    <type>d:text</type>
                </property>
            </properties>
        </aspect>

        <aspect name="sam:isSignedInEdms">
            <properties>
                <property name="sam:signedInEdms">
                    <title>Flag for a signed attachment</title>
                    <type>d:boolean</type>
                </property>
            </properties>
        </aspect>

    </aspects>

</model>