<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans>

    <!--==============================================================-->
    <!--                   Processor WebScripts                       -->
    <!--==============================================================-->

    <bean id="DataBundleProcessorWebscript" class="ru.citeck.ecos.webscripts.processor.DataBundleProcessorWebscript"
          name="dbp.webscript" abstract="true" init-method="init" parent="webscript">
        <property name="processor">
            <bean parent="dbp.sequential" />
        </property>
        <property name="evaluator" ref="TemplateExpressionEvaluator" />
        <property name="mimetypeService" ref="MimetypeService" />
    </bean>

    <bean id="DataBundleProcessorWebScript.download" name="dbp.webscript.download" parent="DataBundleProcessorWebscript">
        <property name="download" value="${args.download!'true'}" />
    </bean>

    <bean id="DataBundleProcessorWebScript.view" name="dbp.webscript.view" parent="DataBundleProcessorWebscript">
        <property name="download" value="${args.download!'false'}" />
    </bean>

    <bean id="webscript.ru.citeck.print.content.get" parent="dbp.webscript.download">
        <property name="processors">
            <list>
                <bean parent="dbp.content">
                    <property name="nodeRef" value="${args.nodeRef}" />
                </bean>
                <bean parent="dbp.model">
                    <property name="model">
                        <map>
                            <entry key="filename" value="#{'$'}{companyhome.nodeByReference[args.nodeRef].properties['cm:name']}" />
                        </map>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.print.barcode.get" parent="dbp.webscript.view">
        <property name="processors">
            <list>
                <ref bean="dbp.pdf.barcode.webscript" />
                <bean parent="dbp.switch">
                    <property name="expression" value="${args.output!'pdf'}" />
                    <property name="cases">
                        <map>
                            <entry key="pdf">
                                <bean parent="dbp.switch">
                                    <property name="expression" value="${args.print!'false'}" />
                                    <property name="cases">
                                        <map>
                                            <entry key="true" value-ref="dbp.pdf.printdialog" />
                                        </map>
                                    </property>
                                </bean>
                            </entry>
                            <entry key="png" value-ref="dbp.transform.png" />
                            <entry key="jpg" value-ref="dbp.transform.jpg" />
                        </map>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.print.printpdf.get" parent="dbp.webscript.view">
        <property name="processors">
            <list>
                <bean parent="dbp.content">
                    <property name="nodeRef" value="${args.nodeRef}" />
                </bean>
                <bean parent="dbp.transform.pdf" />
                <bean parent="dbp.switch">
                    <property name="expression" value="${args.print!'false'}" />
                    <property name="cases">
                        <map>
                            <entry key="true" value-ref="dbp.pdf.printdialog" />
                        </map>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.print.stamppdf.get" parent="dbp.webscript.view">
        <property name="processors">
            <list>
                <bean parent="dbp.content">
                    <property name="nodeRef" value="${args.nodeRef}" />
                </bean>
                <bean parent="dbp.transform.pdf" />
                <bean parent="dbp.pdf.stamp.above">
                    <property name="transformCalculator" ref="dbp.transform.upper.right" />
                    <property name="stampProcessors">
                        <list>
                            <ref bean="dbp.pdf.barcode.webscript" />
                        </list>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.print.finalpdf.get" parent="dbp.webscript.view">
        <property name="processors">
            <list>
                <bean parent="dbp.content">
                    <property name="nodeRef" value="${args.nodeRef}" />
                </bean>
                <bean parent="dbp.transform.pdf" />
                <bean parent="dbp.pdf.stamp.above">
                    <property name="transformCalculator" ref="dbp.transform.diagonal" />
                    <property name="stampProcessors">
                        <list>
                            <bean parent="dbp.content">
                                <property name="nodeRef" value="workspace://SpacesStore/idocs-watermark-final" />
                            </bean>
                        </list>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.print.workflow-details.get" parent="dbp.webscript.view">
        <property name="processors">
            <list>
                <bean parent="dbp.model.workflow">
                    <property name="workflowId" value="${args.workflowId}" />
                </bean>
                <bean parent="dbp.template.html">
                    <property name="template" value="alfresco/templates/webscripts/ru/citeck/print/workflow-details.get.html.ftl" />
                </bean>
                <bean parent="dbp.transform.pdf" />
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.report.criteria-report.post" parent="dbp.webscript.view">
        <property name="processors">
            <list>
                <bean parent="dbp.filter.formtojson" />
                <bean parent="dbp.report.filter" />
                <bean parent="dbp.query.construct">
                    <property name="builder" ref="luceneQueryBuilder"/>
                </bean>
                <bean parent="dbp.query.execute">
                    <property name="language" value="lucene"/>
                </bean>
                <bean parent="dbp.report.producer" />
                <bean parent="dbp.switch">
                    <property name="expression" value="${reportType!'html'}" />
                    <property name="cases">
                        <map>
                            <entry key="xlsx">
                                <bean parent="dbp.report.template.xlsx">
                                    <property name="template" value="alfresco/templates/reports/ru/citeck/default.xlsx"/>
                                </bean>
                            </entry>
                        </map>
                    </property>
                    <property name="default">
                        <bean parent="dbp.report.template.html">
                            <property name="template" value="alfresco/templates/reports/ru/citeck/default.html.ftl"/>
                        </bean>
                    </property>
                </bean>
                <bean parent="dbp.switch">
                    <property name="expression" value="${reportType!'html'}" />
                    <property name="cases">
                        <map>
                            <entry key="pdf" value-ref="dbp.transform.pdf" />
                        </map>
                    </property>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="webscript.ru.citeck.repository.dictionary.classesWithFullQname.get"
          class="org.alfresco.repo.web.scripts.dictionary.ClassesGet"
          parent="webscript">
        <property name="dictionaryService" ref="dictionaryService"/>
        <property name="namespaceService" ref="namespaceService"/>
    </bean>

</beans>