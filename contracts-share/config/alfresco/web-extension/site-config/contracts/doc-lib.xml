<alfresco-config>

	<config evaluator="string-compare" condition="DocLibCustom">
		<dependencies>
			<js src="/components/documentlibrary/contracts/custom-actions.js" />
			<!--js src="/citeck/modules/workflow-owner/workflow-owner.js" /-->
		</dependencies>
	</config>

	<config evaluator="string-compare" condition="DocLibActions">

	<!-- Action definitions -->
	<actions>

		<action id="document-add-payment-for-approved" type="javascript" icon="plus" label="actions.document-add-payment-for-approved">
			<param name="function">onRedirectToCreatePaymentPage</param>
			<permissions>
				<permission allow="true">Write</permission>
			</permissions>
			<evaluator>evaluator.doclib.contracts.agreement</evaluator>
			<evaluator>evaluator.doclib.contracts.agreement.isActive</evaluator>
			<evaluator negate="true">evaluator.doclib.contracts.agreement.isCancelled</evaluator>
		</action>

		<action id="document-add-closing-doc-for-payment" type="javascript" icon="plus" label="actions.document-add-closing-doc-for-payment">
			<param name="function">onRedirectToCreateClosingDocPage</param>
			<permissions>
				<permission allow="true">Write</permission>
			</permissions>
			<evaluator>evaluator.doclib.contracts.agreement</evaluator>
			<evaluator>evaluator.doclib.contracts.agreement.isActive</evaluator>
			<evaluator negate="true">evaluator.doclib.contracts.agreement.isCancelled</evaluator>
		</action>

        <action id="document-add-sup-agreement" type="javascript" icon="plus"
                label="actions.document-add-sup-agreement">
            <param name="function">onRedirectToCreateSupAgreementPage</param>
            <permissions>
                <permission allow="true">Write</permission>
            </permissions>
            <evaluator>evaluator.doclib.contracts.agreement</evaluator>
            <evaluator>evaluator.doclib.contracts.agreement.isActive</evaluator>
            <evaluator negate="true">evaluator.doclib.contracts.agreement.isCancelled</evaluator>
        </action>

		<!-- Upload Signed Version -->
		<action id="upload-signed-version" type="javascript" icon="document-upload-new-version" label="actions.upload-signed-version">
			<param name="function">onActionUploadSignedVersion</param>
			<permissions>
				<permission allow="true">Write</permission>
			</permissions>
			<evaluator>evaluator.doclib.contracts.documentHasSignedVersion</evaluator>
			<evaluator>evaluator.doclib.contracts.isOnSigningOrActive</evaluator>
		</action>

			<!-- Show Signed Version -->
		<action id="show-signed-version" type="javascript" icon="document-approve" label="actions.show-signed-version">
			<param name="function">onShowSignedVersion</param>
			<evaluator>evaluator.doclib.contracts.documentHasSignedVersion</evaluator>
		</action>

        <!--Payment-->
        <action id="document-download-payments" type="link" label="actions.download-payment" icon="document-download">
            <param name="href">/share/proxy/alfresco/citeck/print/metadata-printpdf?nodeRef={node.nodeRef}&amp;templateType=payment-document&amp;format=docx&amp;download=true</param>
            <evaluator>evaluator.doclib.contracts.payment</evaluator>
        </action>

		<!--Closing document-->
		<action id="document-download-closing-document" type="link" label="actions.download-closing-document" icon="document-download">
			<param name="href">/share/proxy/alfresco/citeck/print/metadata-printpdf?nodeRef={node.nodeRef}&amp;templateType=closing-document&amp;format=docx&amp;download=true</param>
			<evaluator>evaluator.doclib.contracts.closingDocument</evaluator>
		</action>

	</actions>

	</config>

	<config evaluator="string-compare" condition="DocumentLibrary">
		<associations>
			<doctype id="contracts:agreement">
				<visible>
					<association name="contracts:closingDocumentAgreement" direction="source" />
					<association name="payments:basis" direction="source" />
					<association name="contracts:mainAgreement" direction="source" />
				</visible>
			</doctype>
			<doctype id="contracts:supplementaryAgreement">
				<visible>
					<association name="payments:basis" direction="source" />
					<association name="contracts:mainAgreement" direction="target" />
				</visible>
			</doctype>
			<doctype id="payments:payment">
				<visible>
					<association name="payments:basis" direction="target" />
				</visible>
			</doctype>
			<doctype id="contracts:closingDocument">
				<visible>
					<association name="contracts:closingDocumentAgreement" direction="target" />
					<association name="contracts:closingDocumentPayment" direction="target" />
				</visible>
			</doctype>
		</associations>

	</config>

	<config evaluator="string-compare" condition="DocLibActions" replace="false">
		<actionGroups>
			<actionGroup id="document-details">

				<action index="10" id="document-download-payments"/>
				<action index="11" id="document-download-closing-document" />
				<action index="200" id="upload-signed-version" />
				<action index="480" id="document-add-payment-for-approved" />
				<action index="490" id="document-add-closing-doc-for-payment" />
				<action index="491" id="document-add-sup-agreement" />

			</actionGroup>
			<actionGroup id="folder-details">
			</actionGroup>
        </actionGroups>
	</config>

	<config evaluator="string-compare" condition="DocLibActions">
		<actions>
			<action id="document-download">
				<param name="href">/share/proxy/alfresco/citeck/print/content?nodeRef={nodeRef}</param>
				<evaluator negate="true">evaluator.doclib.contracts.showCustomDownload</evaluator>
			</action>
		</actions>
	</config>

</alfresco-config>
