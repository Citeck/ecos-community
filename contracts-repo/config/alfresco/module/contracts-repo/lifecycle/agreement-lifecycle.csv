fromState,event,toState,transitionCondition,action
start,"{""eventType"":""automaticTransition""}",project,,"document.properties['idocs:documentStatus'] = 'new'; document.save();"
project,"{""eventType"":""onStartProcess"",""workflowId"":""activiti$confirm"",""actionName"":""confirm"",""formId"":""approve-contractor-form""}",confirmation,"document.properties.creator == person.properties.userName","document.properties['idocs:documentStatus'] = 'onApproval';document.properties['idocs:dateConfirmDueDate'] = process.bpm_workflowDueDate;  document.properties['idocs:precedence'] = process.wfcf_precedence; document.properties['idocs:hasContractorApproval'] = process.cwf_hasContractorApproval;document.save();"
confirmation,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$confirm""}",hasContractorApproval,process.wfcf_confirmed,
confirmation,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$confirm""}",do-rejecting,process.wfcf_workflowCancelled,
hasContractorApproval,"{""eventType"":""automaticTransition""}",сontractorApproval,document.properties['idocs:hasContractorApproval']==true,"startWorkflow(""activiti$contractor-approval"", {""wfca:approvalAgent"": document.properties.creator, ""bpm:workflowDescription"":document.name, ""bpm:workflowDueDate"": translateDaysNumberToDate(20), ""cwf:sendNotification"":true, ""cwf:versionLabelDocument"":document.properties['cm:versionLabel']}); document.properties['idocs:documentStatus'] = 'onApproval'; document.save();"
hasContractorApproval,"{""eventType"":""automaticTransition""}",onSigning,document.properties['idocs:hasContractorApproval']==false,
сontractorApproval,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$contractor-approval""}",onSigning,document.properties['cm:versionLabel'] == process.cwf_versionLabelDocument && process.outcome == 'Approved',
сontractorApproval,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$contractor-approval""}",goto-correct,document.properties['cm:versionLabel'] != process.cwf_versionLabelDocument,
сontractorApproval,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$contractor-approval""}",goto-correct,process.outcome == 'Declined',
onSigning,"{""eventType"":""automaticTransition""}",confirmed,,"document.properties['idocs:documentStatus'] = 'onSign'; document.save();"
confirmed,"{""eventType"":""automaticTransition""}",signing,,"startWorkflow(""activiti$sign"", {""wfsgn_signerGroup"": people.getGroup(""GROUP_clerks""), ""bpm_workflowDescription"":document.name, ""cwf:setInitiator"": true});"
signing,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$sign""}",afterSigning,"process.outcome == 'Signed'","document.properties['idocs:documentStatus'] = 'active'; document.save();"
signing,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$sign""}",cancelled,process.outcome == 'Declined',"document.properties['idocs:documentStatus'] = 'canceled'; document.save();"
afterSigning,"{""eventType"":""automaticTransition""}",archive,,"var paymentDrafts=document.childAssocs[""payments:payments""]||[],legalEntities=document.assocs[""contracts:agreementLegalEntity""]||[],contractors=document.assocs[""contracts:contractor""]||[],commonProperties=[""payments:plannedPaymentDate"",""payments:currency_added"",""payments:paymentAmount"",""payments:paymentVAT""],paymentRoot=search.xpathSearch(""/app:company_home/st:sites/cm:contracts/cm:documentLibrary/cm:payments"")[0];for(var i in paymentDrafts){var properties = new Array(); properties['cm:creator'] = document.properties['cm:creator'];var payment=paymentRoot.createNode(null,""payments:payment"",properties,""cm:contains"");for(var j in commonProperties){var p=commonProperties[j];payment.properties[p]=paymentDrafts[i].properties[p]}payment.save(),payment.createAssociation(document,""payments:basis""),legalEntities.length>0&&payment.createAssociation(legalEntities[0],""payments:payer""),contractors.length>0&&payment.createAssociation(contractors[0],""payments:beneficiary"")}"
on-registration,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$registration""}",declined,process.outcome == 'Declined',
on-registration,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$registration""}",registered,process.outcome == 'Registered',document.properties['idocs:documentStatus'] = 'registered'; document.save();
registered,"{""eventType"":""automaticTransition""}",archive,,"document.properties['idocs:documentStatus'] = 'active'; document.save();"
archive,"{""eventType"":""userTransition"",""actionName"":""move-to-archive""}",archived,,"document.properties['idocs:documentStatus'] = 'archive'; document.save();"
cancelled,"{""eventType"":""userTransition"",""actionName"":""move-to-archive""}",archived,,"document.properties['idocs:documentStatus'] = 'archive'; document.save();"
cancelled,"{""eventType"":""onStartProcess"",""workflowId"":""activiti$confirm"",""actionName"":""confirm"",""formId"":""approve-contractor-form""}",confirmation,"document.properties.creator == person.properties.userName","document.properties['idocs:documentStatus'] = 'onApproval';document.properties['idocs:dateConfirmDueDate'] = process.bpm_workflowDueDate;  document.properties['idocs:precedence'] = process.wfcf_precedence; document.properties['idocs:hasContractorApproval'] = process.cwf_hasContractorApproval;document.save();"
*,"{""eventType"":""timerTransition"",""dateTimeExpression"":""var contractDurationInMonth=-1*getSystemConfig('default-contract-duration');var cal = java.util.Calendar.getInstance();if(getActiveWorkflows('activiti$prolongation').length==0 && !document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:duration']){cal.setTime(document.properties['contracts:duration']);cal.add(java.util.Calendar.MONTH,contractDurationInMonth);cal.getTime();}else if(getActiveWorkflows('activiti$prolongation').length==0 && document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:agreementProlongationEndDate']){cal.setTime(document.properties['contracts:agreementProlongationEndDate']);cal.add(java.util.Calendar.MONTH,contractDurationInMonth);cal.getTime();}""}",,"var contractDurationInMonth=-1*getSystemConfig(""default-contract-duration"");var cal = java.util.Calendar.getInstance();var cal2 = java.util.Calendar.getInstance();if(!document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:duration']){cal.setTime(document.properties['contracts:duration']);cal.add(java.util.Calendar.MONTH,contractDurationInMonth);(document.properties['idocs:documentStatus']!='archive' && cal.get(java.util.Calendar.YEAR)==cal2.get(java.util.Calendar.YEAR) && cal.get(java.util.Calendar.DAY_OF_YEAR) ==cal2.get(java.util.Calendar.DAY_OF_YEAR))}else if(document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:agreementProlongationEndDate']){cal.setTime(document.properties['contracts:agreementProlongationEndDate']);cal.add(java.util.Calendar.MONTH,contractDurationInMonth);(document.properties['idocs:documentStatus']!='archive' && cal.get(java.util.Calendar.YEAR)==cal2.get(java.util.Calendar.YEAR) && cal.get(java.util.Calendar.DAY_OF_YEAR) ==cal2.get(java.util.Calendar.DAY_OF_YEAR));}else{false;}","var initiator = people.getPerson(document.properties.creator); startWorkflow(""activiti$prolongation"", {""wfprolong:prolongs"": initiator, ""bpm:workflowDescription"":document.name, ""cwf:setInitiator"": true});"
*,"{""eventType"":""timerTransition"",""dateTimeExpression"":""var cal = java.util.Calendar.getInstance();if(getActiveWorkflows('activiti$prolongation').length>0 && !document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:duration']){cal.setTime(document.properties['contracts:duration']);cal.getTime();}else if(getActiveWorkflows('activiti$prolongation').length>0 && document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:agreementProlongationEndDate']){cal.setTime(document.properties['contracts:agreementProlongationEndDate']);cal.getTime();}""}",archived,"var cal = java.util.Calendar.getInstance();var cal2 = java.util.Calendar.getInstance();if(!document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:duration']){cal.setTime(document.properties['contracts:duration']);(document.properties['idocs:documentStatus']!='archive' && cal.get(java.util.Calendar.YEAR)==cal2.get(java.util.Calendar.YEAR) && cal.get(java.util.Calendar.DAY_OF_YEAR) ==cal2.get(java.util.Calendar.DAY_OF_YEAR))}else if(document.properties['contracts:agreementWithProlongation'] && document.properties['contracts:agreementProlongationEndDate']){cal.setTime(document.properties['contracts:agreementProlongationEndDate']);(document.properties['idocs:documentStatus']!='archive' && cal.get(java.util.Calendar.YEAR)==cal2.get(java.util.Calendar.YEAR) && cal.get(java.util.Calendar.DAY_OF_YEAR) ==cal2.get(java.util.Calendar.DAY_OF_YEAR));}else{false;}","var tasks = getTaskForWorkflow(""activiti$prolongation""); for(var i=0; i<tasks.length;i++){if(tasks[i]) {completeTask(tasks[i], ""SendToArchive"");}} document.properties['idocs:documentStatus'] = 'archive'; document.save();"
*,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$prolongation""}",archived,"process.outcome == 'SendToArchive'","document.properties['idocs:documentStatus'] = 'archive'; document.save();"

goto-correct,"{""eventType"":""automaticTransition""}",correct,,"var corrector = people.getPerson(document.properties.creator); startWorkflow(""activiti$correction"", {""cwf:setInitiator"": true, ""wfcr:corrector"": corrector, ""wfcr:canChooseConfirmers"": true, ""wfcr:canChangeDueDate"": true, ""wfcr:canChangePriority"": true, ""wfcr:allConfirmers"": confirmDecisions.listConfirmers(document), ""wfcr:rejectedConfirmers"": confirmDecisions.listConfirmers(document, ""Reject""), ""wfcr:dueDate"": document.properties[""idocs:dateConfirmDueDate""], ""wfcr:priority"": document.properties[""idocs:priorityConfirm""], ""bpm:workflowPriority"": document.properties[""idocs:priorityConfirm""]}); "

correct,"{""eventType"":""onEndProcess"",""workflowId"":""activiti$correction""}",confirmation,process.outcome == 'ForAll',"document.properties[""idocs:dateConfirmDueDate""] = process.wfcr_dueDate; document.save(); startWorkflow(""activiti$confirm"", {""wfcf_confirmers"":process.wfcr_confirmers,""wfcf_precedence"":document.properties['idocs:precedence'],""bpm:workflowDescription"":document.name}); document.properties['idocs:documentStatus'] = 'onApproval'; document.save();"
rejected,"{""eventType"":""onStartProcess"",""workflowId"":""activiti$confirm"",""actionName"":""confirm""}",confirmation,"document.properties.creator == person.properties.userName","document.properties['idocs:documentStatus'] = 'onApproval'; document.save(); process.bpm_workflowDescription = document.name;"


