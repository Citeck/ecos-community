<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE beans PUBLIC '-//SPRING//DTD BEAN//EN' 'http://www.springframework.org/dtd/spring-beans.dtd'>
<beans>

	<bean id="contracts.AgreementNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="contracts:agreement" />
		<property name="nameTemplate">
			<value><![CDATA[<#if .locale == "ru_RU">Договор<#else>Contract</#if> №#{'$'}{node.properties['contracts:agreementNumber']!'n/a'}]]></value>
		</property>
		<property name="order" value="40"/>
	</bean>

	<bean id="contracts.agreementTitleBehaviour" parent="TitleGenerationBehaviour">
		<property name="className" value="contracts:agreement" />
		<property name="titleMLTemplate">
			<map>
				<entry key="ru_RU">
					<value><![CDATA[Договор №#{'$'}{node.properties['contracts:agreementNumber']!'б-н'}]]></value>
				</entry>
				<entry key="en_US">
					<value><![CDATA[Contract №#{'$'}{node.properties['contracts:agreementNumber']!'n/a'}]]></value>
				</entry>
				<entry key="lt_LT">
					<value><![CDATA[Susitarimas №#{'$'}{node.properties['contracts:agreementNumber']!'n/a'}]]></value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="contracts.supAgreementNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="contracts:supplementaryAgreement" />
		<property name="nameTemplate">
			<value><![CDATA[<#if .locale == "ru_RU">Доп.соглашение<#else>Add'l agreement</#if> №#{'$'}{node.properties['contracts:agreementNumber']!'n/a'}]]></value>
		</property>
		<property name="appendExtension" value="false" />
		<property name="order" value="40"/>
	</bean>

	<bean id="contracts.supAgreementTitleBehaviour" parent="TitleGenerationBehaviour">
		<property name="className" value="contracts:supplementaryAgreement" />
		<property name="titleMLTemplate">
			<map>
				<entry key="ru_RU">
					<value><![CDATA[Доп.соглашение №#{'$'}{node.properties['contracts:agreementNumber']!'б-н'}]]></value>
				</entry>
				<entry key="en_US">
					<value><![CDATA[Add'l agreement №#{'$'}{node.properties['contracts:agreementNumber']!'n/a'}]]></value>
				</entry>
				<entry key="lt_LT">
					<value><![CDATA[Papildomo susitarimo №#{'$'}{node.properties['contracts:agreementNumber']!'n/a'}]]></value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="contracts.subjectNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="contracts:subject" />
		<property name="nameTemplate"
			value="#{'$'}{node.properties['contracts:subjectName']!'no-name'}" />
	</bean>

	<bean id="contracts.paymentNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="payments:payment" />
		<property name="nameTemplate">
			<value><![CDATA[<#if .locale == "ru_RU">Счет<#else>Invoice</#if> №#{'$'}{node.properties['payments:paymentNumber']!'n/a'} <#if .locale == "ru_RU">для<#else>for</#if><#if node.assocs['payments:beneficiary']?? && node.assocs['payments:beneficiary']?size &gt; 0> #{'$'}{node.assocs['payments:beneficiary'][0].name}</#if>]]></value>
		</property>
		<property name="appendExtension" value="false" />
		<property name="order" value="40"/>
	</bean>

	<bean id="contracts.paymentTitleBehaviour" parent="TitleGenerationBehaviour">
		<property name="className" value="payments:payment" />
		<property name="titleMLTemplate">
			<map>
				<entry key="ru_RU">
					<value><![CDATA[Счет №#{'$'}{node.properties['payments:paymentNumber']!'б-н'} для<#if node.assocs['payments:beneficiary']?? && node.assocs['payments:beneficiary']?size &gt; 0> #{'$'}{node.assocs['payments:beneficiary'][0].name}</#if>]]></value>
				</entry>
				<entry key="en_US">
					<value><![CDATA[Invoice №#{'$'}{node.properties['payments:paymentNumber']!'n/a'} for<#if node.assocs['payments:beneficiary']?? && node.assocs['payments:beneficiary']?size &gt; 0> #{'$'}{node.assocs['payments:beneficiary'][0].name}</#if>]]></value>
				</entry>
				<entry key="lt_LT">
					<value><![CDATA[Sąskaita №#{'$'}{node.properties['payments:paymentNumber']!'n/a'} už<#if node.assocs['payments:beneficiary']?? && node.assocs['payments:beneficiary']?size &gt; 0> #{'$'}{node.assocs['payments:beneficiary'][0].name}</#if>]]></value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="contracts.paymentDraftNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="payments:paymentDraft" />
		<property name="nameTemplate">
			<value><![CDATA[<#if .locale == "ru_RU">Счет<#else>Payment</#if><#if node.parent.nodeRef??> <#if .locale == "ru_RU">для контракта<#else>for contract</#if> №#{'$'}{node.parent.properties['contracts:agreementNumber']!'n/a'}</#if>]]></value>
		</property>
	</bean>

	<bean id="contracts.paymentDraftTitleBehaviour" parent="TitleGenerationBehaviour">
		<property name="className" value="payments:paymentDraft" />
		<property name="titleMLTemplate">
			<map>
				<entry key="ru_RU">
					<value><![CDATA[Платеж<#if node.parent.nodeRef??> для договора №#{'$'}{node.parent.properties['contracts:agreementNumber']!'б-н'}</#if>]]></value>
				</entry>
				<entry key="en_US">
					<value><![CDATA[Payment<#if node.parent.nodeRef??> for contract №#{'$'}{node.parent.properties['contracts:agreementNumber']!'n/a'}</#if>]]></value>
				</entry>
				<entry key="lt_LT">
					<value><![CDATA[Mokėjimas<#if node.parent.nodeRef??> sutarčiai №#{'$'}{node.parent.properties['contracts:agreementNumber']!'n/a'}</#if>]]></value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="contracts.paymentPeriodNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="payments:period" />
		<property name="nameTemplate">
			<value><![CDATA[<#if .locale == "ru_RU">Период<#else>Period</#if> #{'$'}{node.properties['payments:periodStart']?string('dd.MM.yyyy')}-#{'$'}{node.properties['payments:periodEnd']?string('dd.MM.yyyy')}]]></value>
		</property>
	</bean>

	<bean id="contracts.closingDocumentNamingBehaviour" parent="AutoNameBehaviour">
		<property name="className" value="contracts:closingDocument"/>
		<property name="nameTemplate">
			<value><![CDATA[<#if .locale == "ru_RU" && node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef != 'workspace://SpacesStore/contracts-cat-closing-doc-other'><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-invoice'>Счет-фактура<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-act'>Акт<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-delivery'>Накладная</#if> №#{'$'}{node.properties['contracts:closingDocumentNumber']!'б-н'}<#if node.assocs['contracts:contractor']?? && node.assocs['contracts:contractor']?size &gt; 0> для #{'$'}{node.assocs['contracts:contractor'][0].name}</#if><#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef != 'workspace://SpacesStore/contracts-cat-closing-doc-other'><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-invoice'>Invoice<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-act'>Act<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-delivery'>Delivery</#if> №#{'$'}{node.properties['contracts:closingDocumentNumber']!'n/a'}<#if node.assocs['contracts:contractor']?? && node.assocs['contracts:contractor']?size &gt; 0> for #{'$'}{node.assocs['contracts:contractor'][0].name}</#if></#if>]]></value>
		</property>
		<property name="appendExtension" value="false" />
		<property name="order" value="40"/>
	</bean>

	<bean id="contracts.closingDocumentTitleBehaviour" parent="TitleGenerationBehaviour">
		<property name="className" value="contracts:closingDocument"/>
		<property name="titleMLTemplate">
			<map>
				<entry key="ru_RU">
					<value><![CDATA[<#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef != 'workspace://SpacesStore/contracts-cat-closing-doc-other'><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-invoice'>Счет-фактура<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-act'>Акт<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-delivery'>Накладная</#if> №#{'$'}{node.properties['contracts:closingDocumentNumber']!'б-н'}<#if node.assocs['contracts:contractor']?? && node.assocs['contracts:contractor']?size &gt; 0> для #{'$'}{node.assocs['contracts:contractor'][0].name}</#if></#if><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-other'>#{'$'}{node.properties['cm:name']}</#if>]]></value>
				</entry>
				<entry key="en_US">
					<value><![CDATA[<#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef != 'workspace://SpacesStore/contracts-cat-closing-doc-other'><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-invoice'>Invoice<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-act'>Act<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-delivery'>Delivery</#if> №#{'$'}{node.properties['contracts:closingDocumentNumber']!'n/a'}<#if node.assocs['contracts:contractor']?? && node.assocs['contracts:contractor']?size &gt; 0> for #{'$'}{node.assocs['contracts:contractor'][0].name}</#if></#if><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-other'>#{'$'}{node.properties['cm:name']}</#if>]]></value>
				</entry>
				<entry key="lt_LT">
					<value><![CDATA[<#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef != 'workspace://SpacesStore/contracts-cat-closing-doc-other'><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-invoice'>Faktūra<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-act'>Aktas<#elseif node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-delivery'>Važtaraštis</#if> №#{'$'}{node.properties['contracts:closingDocumentNumber']!'n/a'}<#if node.assocs['contracts:contractor']?? && node.assocs['contracts:contractor']?size &gt; 0> už #{'$'}{node.assocs['contracts:contractor'][0].name}</#if></#if><#if node.properties['tk:kind']?? && node.properties['tk:kind'].nodeRef == 'workspace://SpacesStore/contracts-cat-closing-doc-other'>#{'$'}{node.properties['cm:name']}</#if>]]></value>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="contracts.agreementNumberBehaviour" parent="EnumerationBehaviour">
        <property name="className" value="contracts:agreement" />
        <property name="numberField" value="contracts:agreementNumber" />
		<property name="enabledState" value="-" />
        <property name="templateName" value="agreement-number-template" />
    </bean>

	<bean id="contracts.closingDocumentNumberBehaviour" parent="EnumerationBehaviour">
		<property name="className" value="contracts:closingDocument" />
		<property name="numberField" value="contracts:closingDocumentNumber" />
		<property name="enabledState" value="-" />
		<property name="templateName" value="closing-doc-number-template" />
	</bean>

	<bean id="contracts.supAgreementNumberBehaviour" parent="EnumerationBehaviour">
		<property name="className" value="contracts:supplementaryAgreement" />
		<property name="numberField" value="contracts:agreementNumber" />
		<property name="enabledState" value="-" />
		<property name="templateName" value="supAgreement-number-template" />
	</bean>

	<bean id="contracts.paymentNumberBehaviour" parent="EnumerationBehaviour">
		<property name="className" value="payments:payment" />
		<property name="numberField" value="payments:paymentNumber" />
		<property name="enabledState" value="-" />
		<property name="templateName" value="payment-number-template" />
	</bean>

	<bean id="productsAndServicesTotalAmountInDocument"
		  class="ru.citeck.ecos.behavior.contracts.ProductsAndServicesTotalAmountInDocumentBehaviour"
		  init-method="init">
		<property name="allowedTypes">
			<map>
				<entry key="payments:payment" value="payments:paymentAmount"/>
				<entry key="contracts:closingDocument" value="contracts:closingDocumentAmount"/>
			</map>
		</property>
	</bean>

	<bean id="paymentsBehaviour" class="ru.citeck.ecos.behavior.contracts.PaymentsBehaviour" init-method="init">
		<property name="nodeService" ref="nodeService"/>
		<property name="searchService" ref="searchService"/>
		<property name="policyComponent" ref="policyComponent"/>
		<property name="type" value="payments:payment"/>
		<property name="order" value="80"/>
	</bean>

	<bean id="amountInWords.payments" class="ru.citeck.ecos.behavior.common.AmountInWordBehaviour" init-method="init">
		<property name="docType" value="payments:payment"/>
		<property name="amountProperty" value="payments:paymentAmount"/>
		<property name="amountInWordProperty" value="payments:paymentAmountInWords"/>
		<property name="currencyAssoc" value="payments:currency"/>
	</bean>

	<bean id="contracts.closingDocumentBehaviour" class="ru.citeck.ecos.behavior.contracts.ClosingDocumentBehaviour"
		  init-method="init">
		<property name="nodeService" ref="nodeService" />
		<property name="searchService" ref="searchService"/>
		<property name="policyComponent" ref="policyComponent" />
		<property name="namespace" value="http://www.citeck.ru/model/contracts/1.0"/>
		<property name="type" value="closingDocument"/>
		<property name="order" value="80"/>
	</bean>

	<bean id="payment.relay-currency.pas"
		  class="ru.citeck.ecos.behavior.common.RelayCurrencyToAssocsBehaviour"
		  init-method="init">
		<property name="docType" value="payments:payment"/>
		<property name="targetAssoc" value="pas:containsProductsAndServices"/>
		<property name="sourceCurrencyAssoc" value="payments:currency"/>
		<property name="targetCurrencyAssoc" value="pas:currency"/>
	</bean>

	<bean id="closingDocument.relay-currency.pas"
		  class="ru.citeck.ecos.behavior.common.RelayCurrencyToAssocsBehaviour"
		  init-method="init">
		<property name="docType" value="contracts:closingDocument"/>
		<property name="targetAssoc" value="pas:containsProductsAndServices"/>
		<property name="sourceCurrencyAssoc" value="contracts:closingDocumentCurrency"/>
		<property name="targetCurrencyAssoc" value="pas:currency"/>
	</bean>

	<bean id="contracts.selectSignerBehaviour" class="ru.citeck.ecos.behavior.SelectSignerBehaviour" init-method="init">
		<property name="nodeService" ref="nodeService" />
		<property name="policyComponent" ref="policyComponent" />
		<property name="workflowService" ref="WorkflowService" />
	</bean>

	<bean id="contracts.createRejectionEventBehaviour"
		  class="ru.citeck.ecos.behavior.ContractsCreateEventsByRejectionBehaviour"
		  init-method="init">
		<property name="historyService" ref="historyService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="policyComponent" ref="policyComponent"/>
		<property name="order" value="120"/>
	</bean>

	<bean id="contracts.createDeliveryFailedEventBehaviour"
		  class="ru.citeck.ecos.behavior.ContractsCreateEventsByFailBehaviour"
		  init-method="init">
		<property name="historyService" ref="historyService"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="policyComponent" ref="policyComponent"/>
		<property name="order" value="120"/>
	</bean>

	<bean id="contracts.setAspectForAttachments"
		  class="ru.citeck.ecos.behavior.ContractsSetAspectForAttachments"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
	</bean>

	<bean id="contracts.createEventsForAttachments"
		  class="ru.citeck.ecos.behavior.ContractsCreateEventsForAttachments"
		  init-method="init">
		<property name="policyComponent" ref="policyComponent"/>
		<property name="nodeService" ref="nodeService"/>
		<property name="historyService" ref="historyService"/>
	</bean>

	<bean id="contracts.diadocAttachmentsStatusBehaviour" init-method="init" abstract="true"
		  class="ru.citeck.ecos.behavior.DiadocAttachmentsStatusBehaviour">
		<property name="nodeService" ref="nodeService" />
		<property name="scriptService" ref="scriptService" />
		<property name="policyComponent" ref="policyComponent" />
		<property name="parentAssocName" value="icase:documents" />
		<property name="attachmentClassName" value="contracts:agreement" />
	</bean>

	<bean id="contracts.packageAttachments.diadocAttachmentsStatusBehaviour" init-method="init" abstract="true"
		  class="ru.citeck.ecos.behavior.DiadocAttachmentsStatusBehaviour">
		<property name="nodeService" ref="nodeService" />
		<property name="scriptService" ref="scriptService" />
		<property name="policyComponent" ref="policyComponent" />
		<property name="assocName" value="sam:packageAttachments" />
		<property name="attachmentClassName" value="idocs:doc" />
	</bean>

	<bean id="contracts.packageAttachments.diadocAttachmentsStateBehaviour"
		  parent="contracts.packageAttachments.diadocAttachmentsStatusBehaviour"
		  class="ru.citeck.ecos.behavior.DiadocAttachmentsStateBehaviour">
	</bean>

	<bean id="contracts.diadocAttachmentsStateBehaviour"
		  parent="contracts.diadocAttachmentsStatusBehaviour"
		  class="ru.citeck.ecos.behavior.DiadocAttachmentsStateBehaviour">
	</bean>

	<bean id="contracts.DiadocContractNotificationToSignatoryBehaviour"
		  parent="contracts.diadocAttachmentsStatusBehaviour"
		  class="ru.citeck.ecos.behavior.DiadocContractNotificationBehaviour">
		<property name="enabled" value="true" />
		<property name="recipients" value="signer" />
		<property name="caseRoleService" ref="caseRoleService" />
		<property name="dictionaryService" ref="dictionaryService" />
		<property name="notificationService" ref="notificationService" />
		<property name="transactionService" ref="transactionService" />
		<property name="template" value="workspace://SpacesStore/contract-att-notification-template" />
		<property name="transitions">
			<map>
				<!-- SIGN REQUEST -->
				<entry>
					<key>
						<bean class="ru.citeck.ecos.behavior.DiadocAttachmentsStatusBehaviour.Transition">
							<constructor-arg value="SENT" />
							<constructor-arg value="DELIVERY_FAILED" />
						</bean>
					</key>
					<bean class="ru.citeck.ecos.behavior.DiadocAttachmentsNotificationBehaviour.EventData">
						<property name="subjectScript" value="'Не удалось отправить подписанный документ ' + (attachment.properties['cm:title'] || attachment.name)" />
						<property name="emailType" value="SIGNING_DELIVERY_FAILED" />
					</bean>
				</entry>
			</map>
		</property>
	</bean>

	<bean id="contracts.updateInactivityPeriodBehavior" class="ru.citeck.ecos.behavior.UpdateInactivityPeriodBehavior"/>

</beans>